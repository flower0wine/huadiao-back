"use strict";(self["webpackChunkhuadiao_management"]=self["webpackChunkhuadiao_management"]||[]).push([[480],{4480:function(e,t,i){i.r(t),i.d(t,{default:function(){return $}});var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"manage-content-container"},[t("div",{staticClass:"user-collection-broad",on:{click:function(t){e.users.pagerTotal++}}},[t("div",{staticClass:"user-collection-container"},[t("div",{staticClass:"option-title"},[e._v("用户列表")]),t("div",{staticClass:"user-collection-form",on:{wheel:e.scrollAutoShow}},[t("table",{staticClass:"user-collection-origin"},[t("thead",[t("tr",{staticClass:"user-info-attribute"},e._l(e.users.userInfoAttribute,(function(i,s){return t("th",{key:s},[e._v(e._s(i)+" ")])})),0)]),t("tbody",e._l(e.users.singlePageUserInfo,(function(i){return t("tr",{key:i.uid},e._l(i,(function(i,s){return t("td",{key:s},[i&&""!==i?s===e.invalidInfoSubstitutes.judgeConditions.logoffField?[i===e.invalidInfoSubstitutes.judgeConditions.logoff?t("div",[e._v(" "+e._s(e.invalidInfoSubstitutes.substitutes.logoff)+" ")]):t("div",[e._v(" "+e._s(e.invalidInfoSubstitutes.substitutes.noLogoff)+" ")])]:e.invalidInfoSubstitutes.judgeConditions.dateFields.includes(s)?[t("div",[e._v(e._s(e.formatDate(i)))])]:[e._v(e._s(i))]:[t("div",[e._v(e._s(e.invalidInfoSubstitutes.substitutes.nullValueSubstitute))])]],2)})),0)})),0)])]),t("edit-tools",{attrs:{userCollectionsAmount:e.users.singlePageUserInfo.length,getOneUserInfo:e.getOneUserInfo,deleteUser:e.deleteUser}})],1)]),t("pager",{ref:"pager",attrs:{pagerTotal:e.pagerConfig.pagerTotal,pageLimit:e.pagerConfig.pageLimit}}),t("transition",{attrs:{name:"fade",appear:""}},[t("user-details",{directives:[{name:"show",rawName:"v-show",value:e.userDetailVisible,expression:"userDetailVisible"}],attrs:{userInfoAttribute:e.users.userInfoAttribute,editingUserInfo:e.users.editingUserInfo,shutdownUserDetails:e.shutdownUserDetails,commitUserDetails:e.commitUserDetails}})],1)],1)},a=[],r=(i(7658),i(9755)),n=i.n(r),l=i(3280),o=i.n(l),u=i(7640),d=i.n(u),g=i(7126),c=function(){var e=this,t=e._self._c;return t("div",{staticClass:"user-details-background"},[t("div",{staticClass:"user-details-container"},[t("div",{staticClass:"user-details-header"},[t("div",{staticClass:"user-details-shutdown-container",attrs:{title:e.tip.shutdownTip},on:{click:e.shutdownUserDetails}},[e._m(0)]),t("div",{staticClass:"user-details-title"},[e._v("修改用户信息")]),t("div",{staticClass:"user-details-commit",on:{click:e.clickCommitButton}},[t("svg",{staticClass:"icon",attrs:{t:"1671861139342",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"5046",width:"200",height:"200"}},[t("path",{attrs:{d:"M689.3568 820.9408 333.6192 820.9408c-13.9264 0-25.1904-11.264-25.1904-25.1904L308.4288 465.152l-211.968 0c-10.1888 0-19.4048-6.144-23.296-15.5648C69.2224 440.2176 71.424 429.312 78.6432 422.144l415.0272-415.0784c9.472-9.472 26.1632-9.472 35.6352 0l411.392 411.3408c7.2704 4.4544 12.0832 12.4416 12.0832 21.5552 0 14.1312-11.52 24.576-25.7024 25.1904-0.1536 0-0.3072 0-0.512 0l-211.968 0 0 330.5472C714.5984 809.6256 703.2832 820.9408 689.3568 820.9408zM358.8096 770.5088l305.3568 0L664.1664 439.9616c0-13.9264 11.264-25.1904 25.1904-25.1904l176.3328 0L511.488 60.5184 157.2864 414.7712l176.3328 0c13.9264 0 25.1904 11.264 25.1904 25.1904L358.8096 770.5088z","p-id":"5047"}}),t("path",{attrs:{d:"M96.4096 923.1872l830.1056 0L926.5152 1024 96.4096 1024 96.4096 923.1872 96.4096 923.1872zM96.4096 923.1872","p-id":"5048"}})]),t("div",{staticClass:"edit-tools-name"},[e._v("提交")])])]),t("div",{staticClass:"user-details-content"},[t("div",{staticClass:"user-details-attribute-column"},e._l(e.userInfoAttribute,(function(i,s){return t("div",{key:s,staticClass:"user-details-attribute"},[e._v(e._s(i))])})),0),t("div",{staticClass:"user-details-input-column"},e._l(e.editingUserInfoCopy,(function(e,i){return t("div",{key:i,staticClass:"user-details-input-container"},[t("input",{staticClass:"user-details-input",attrs:{type:"text"},domProps:{value:e}})])})),0)])])])},p=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"user-details-shutdown"},[t("div",{staticClass:"shutdown-icon"},[e._v("x")])])}],m={name:"UserDetails",props:["userInfoAttribute","editingUserInfo","shutdownUserDetails","commitUserDetails"],data(){return{tip:o(),editingUserInfoCopy:{}}},watch:{editingUserInfo:{handler(e){if(e)for(let t in e)Object.hasOwnProperty.call(this.editingUserInfoCopy,t)?this.editingUserInfoCopy[t]=e[t]:this.$set(this.editingUserInfoCopy,t,e[t])}}},methods:{clickCommitButton(){if(confirm(this.tip.irrevocable)){let e=n()(".user-details-input-column .user-details-input"),t=[];for(let i=0;i<e.length;i++)t.push(n()(e[i]).val());this.commitUserDetails(t)}}}},h=m,f=i(1001),v=(0,f.Z)(h,c,p,!1,null,"7e2ffc53",null),I=v.exports,b=function(){var e=this,t=e._self._c;return t("div",{staticClass:"edit-tools-broad"},[e._m(0),e._l(e.userCollectionsAmount,(function(i){return t("div",{key:i,staticClass:"edit-tools"},[t("div",{staticClass:"edit-tools-edit",on:{click:e.clickEditButton}},[t("svg",{staticClass:"icon",attrs:{t:"1671861040545",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2698",width:"200",height:"200"}},[t("path",{attrs:{d:"M194.717696 279.69536h8.923136c135.837696 0 271.673344-0.006144 407.51104 0.01024 10.797056 0.528384 15.065088 8.0384 15.27808 13.1584-0.299008 6.486016-6.529024 12.587008-14.977024 12.955648-3.407872 0.147456-3.209216 0.01024-6.623232 0.01024-123.549696 0.004096-247.099392 0.004096-370.649088 0.004096h-13.334528v11.855872c0 145.73568-0.004096 291.469312 0.006144 437.204992 0 20.568064 6.346752 27.119616 26.650624 27.119616 195.56352 0.032768 391.129088 0.024576 586.692608 0 2.998272 0 5.996544-0.299008 10.305536-0.528384v-13.38368c0-104.439808-0.065536-212.400128 0.231424-316.837888 0.016384-5.154816 4.857856-12.713984 13.119488-12.886016 6.111232-0.129024 12.72832 6.100992 12.642304 12.75904-0.268288 20.81792 0 41.8304 0 62.650368V808.019968h-11.270144c-204.77952 0-409.55904 0.008192-614.33856-0.004096-30.99648-0.004096-50.163712-19.316736-50.16576-50.511872-0.01024-155.287552-0.004096-310.581248-0.004096-465.872896l0.002048-11.935744z",fill:"","p-id":"2699"}}),t("path",{attrs:{d:"M785.620992 162.793472l119.90016 92.536832c-9.078784 11.773952-17.719296 23.035904-26.417152 34.2528-86.706176 111.804416-173.406208 223.614976-260.22912 335.331328-2.357248 3.03104-5.728256 6.017024-9.254912 7.292928-38.367232 13.879296-76.859392 27.420672-115.326976 41.03168-1.2288 0.436224-2.531328 0.65536-4.89472 1.247232 1.103872-31.952896 2.17088-63.232 3.278848-94.507008 0.157696-4.427776 1.14688-8.073216 0.667648-13.264896-1.93536-20.963328 6.141952-36.440064 18.706432-52.48 89.786368-114.61632 178.76992-229.861376 268.023808-344.895488 1.644544-2.121728 3.469312-4.102144 5.545984-6.545408z m-42.6496 97.746944c-2.830336 3.319808-5.330944 6.027264-7.579648 8.927232-66.05824 85.133312-131.749888 170.553344-198.443008 255.186944-11.776 14.944256-18.896896 29.6448-18.151424 48.748544 0.815104 20.959232 0.186368 41.971712 0.186368 63.619072 22.857728-8.128512 46.645248-16.19968 70.078464-25.192448 5.931008-2.279424 11.956224-6.551552 15.859712-11.532288 46.686208-59.592704 92.983296-119.484416 139.372544-179.310592 25.655296-33.091584 51.288064-66.2016 77.305856-99.790848l-78.628864-60.655616z m94.593024 40.116224l31.449088-40.677376-79.036416-60.944384-31.430656 40.59136c26.447872 20.424704 52.297728 40.392704 79.017984 61.0304z",fill:"","p-id":"2700"}})]),t("div",{staticClass:"edit-tools-name"},[e._v("编辑")])]),t("div",{staticClass:"edit-tools-remove",on:{click:e.clickDeleteButton}},[t("svg",{staticClass:"icon",attrs:{t:"1671862695787",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2877",width:"200",height:"200"}},[t("path",{attrs:{d:"M202.666667 256h-42.666667a32 32 0 0 1 0-64h704a32 32 0 0 1 0 64H266.666667v565.333333a53.333333 53.333333 0 0 0 53.333333 53.333334h384a53.333333 53.333333 0 0 0 53.333333-53.333334V352a32 32 0 0 1 64 0v469.333333c0 64.8-52.533333 117.333333-117.333333 117.333334H320c-64.8 0-117.333333-52.533333-117.333333-117.333334V256z m224-106.666667a32 32 0 0 1 0-64h170.666666a32 32 0 0 1 0 64H426.666667z m-32 288a32 32 0 0 1 64 0v256a32 32 0 0 1-64 0V437.333333z m170.666666 0a32 32 0 0 1 64 0v256a32 32 0 0 1-64 0V437.333333z","p-id":"2878"}})]),t("div",{staticClass:"edit-tools-name"},[e._v("删除")])])])}))],2)},C=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"edit-tools-header"},[t("div",{staticClass:"edit-tools-title"},[e._v("编辑工具")])])}],_={name:"EditTools",props:["userCollectionsAmount","getOneUserInfo","deleteUser"],data(){return{}},methods:{clickEditButton(e){let t=n()(e.target).parents(".edit-tools");this.getOneUserInfo(t.index())},clickDeleteButton(e){let t=n()(e.target).parents(".edit-tools");this.deleteUser(t.index())}},beforeDestroy(){}},x=_,U=(0,f.Z)(x,b,C,!1,null,"52a53fc0",null),w=U.exports,D=function(){var e=this,t=e._self._c;return 0!==e.pageNumber?t("div",{staticClass:"pager-container"},[t("ul",[t("li",{directives:[{name:"show",rawName:"v-show",value:1!==e.pagerItemActiveIndex,expression:"pagerItemActiveIndex !== 1"}],staticClass:"pager-prev",on:{click:e.prevPage}},[e._v("上一页 ")]),e.pageNumber>=1?t("li",{staticClass:"pager-item pager-item-active"},[e._v("1")]):e._e(),e.pageNumber>=2?t("li",{staticClass:"pager-item"},[e._v("2")]):e._e(),e.pageNumber>=3?t("li",{staticClass:"pager-item"},[e._v("3")]):e._e(),e.visible.beforePagerEllipsis?t("li",{staticClass:"pager-ellipsis"},[e._v("...")]):e._e(),e.visible.middlePagerItemsVisible?e._l(e.visible.visiblePagerRange.length,(function(i,s){return t("li",{key:e.visible.visiblePagerRange.start+s,staticClass:"pager-item",on:{click:e.pagerItemClickEvent}},[e._v(e._s(e.visible.visiblePagerRange.start+s)+" ")])})):e._e(),e.visible.afterPagerEllipsis?t("li",{staticClass:"pager-ellipsis"},[e._v("...")]):e._e(),e.pageNumber>=6?t("li",{staticClass:"pager-item"},[e._v(e._s(e.pageNumber-2))]):e._e(),e.pageNumber>=5?t("li",{staticClass:"pager-item"},[e._v(e._s(e.pageNumber-1))]):e._e(),e.pageNumber>=4?t("li",{staticClass:"pager-item"},[e._v(e._s(e.pageNumber))]):e._e(),t("li",{directives:[{name:"show",rawName:"v-show",value:e.pagerItemActiveIndex!==e.pageNumber,expression:"pagerItemActiveIndex !== pageNumber"}],staticClass:"pager-next",on:{click:e.nextPage}},[e._v("下一页 ")]),t("li",{staticClass:"pager-total"},[e._v("共 "+e._s(e.pageNumber)+" 页")]),t("li",{staticClass:"pager-options-elevator",on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.pagerOptionsElevator.apply(null,arguments)}}},[t("span",[e._v(", 跳至")]),t("input",{staticClass:"pager-input",attrs:{type:"text"}}),t("span",[e._v("页")])])],2)]):e._e()},k=[],A={name:"UserCollectionsPager",props:["pagerTotal","pageLimit"],data(){return{pagerItemActiveIndex:1,visible:{beforePagerEllipsis:!1,afterPagerEllipsis:!1,middlePagerItemsVisible:!1,visiblePagerRange:{start:void 0,length:0}}}},mounted(){},computed:{pageNumber:{get(){return Math.ceil(this.pagerTotal/this.pageLimit)},set(e){}}},watch:{pageNumber:{immediate:!0,handler(e,t){e&&(this.pageNumber>6&&(this.visible.beforePagerEllipsis=!0),this.$nextTick((()=>{n()(".pager-item").click(this.pagerItemClickEvent)})))}},pagerItemActiveIndex:{handler(e,t){let i,s,a=!1,r=!1,n=!1;this.pagerItemActiveIndex<=3||this.pagerItemActiveIndex>=this.pageNumber-2?this.pageNumber>=7?3===this.pagerItemActiveIndex?(a=!0,r=!1,n=!(7===this.pageNumber),i=4,s=1):this.pagerItemActiveIndex===this.pageNumber-2?(a=!0,r=!(7===this.pageNumber),n=!1,i=this.pageNumber-3,s=1):(a=!1,r=!0,n=!1,s=0):(a=!1,r=n=!1):4===this.pagerItemActiveIndex||this.pagerItemActiveIndex===this.pageNumber-3?(this.pageNumber-3===4?(i=4,s=1,r=n=!1):this.pageNumber-4===4?(i=4,s=2,r=n=!1):4===this.pagerItemActiveIndex?(i=4,s=3,this.pageNumber>=9&&(n=!0)):this.pagerItemActiveIndex===this.pageNumber-3&&(i=this.pageNumber-5,s=3,this.pageNumber>=9&&(r=!0)),a=!0):9===this.pageNumber?(r=n=!1,a=!0,i=4,s=3):5===this.pagerItemActiveIndex?(r=!1,n=!0,a=!0,i=4,s=3):this.pagerItemActiveIndex===this.pageNumber-4?(r=!0,n=!1,a=!0,i=this.pageNumber-5,s=3):(r=n=!0,a=!0,i=this.pagerItemActiveIndex-1,s=3),this.visible.visiblePagerRange.start=i,this.visible.visiblePagerRange.length=s,this.visible.middlePagerItemsVisible=a,this.visible.beforePagerEllipsis=r,this.visible.afterPagerEllipsis=n}}},methods:{prevPage(){this.pagerItemActiveIndex>1?(this.pagerItemActiveIndex--,this.$bus.$emit("modifySinglePagerIndex",this.pagerItemActiveIndex)):this.$bus.$emit("addWarningTip","已经是第一页，无法跳转上一页！！！","warning")},nextPage(){this.pagerItemActiveIndex<this.pageNumber?(this.pagerItemActiveIndex++,this.$bus.$emit("modifySinglePagerIndex",this.pagerItemActiveIndex)):this.$bus.$emit("addWarningTip","已经是最后一页，无法跳转下一页！！！","warning")},pagerItemClickEvent(e){let t=n()(e.target),i=Number(t.text()),s=n()(".pager-item");i>=1&&i<=this.pageNumber?(this.pagerItemActiveIndex=i,this.$bus.$emit("modifySinglePagerIndex",this.pagerItemActiveIndex)):this.$bus.$emit("addWarningTip","第 "+i+" 页不存在！！！","warning"),s.removeClass("pager-item-active"),t.addClass("pager-item-active")},pagerOptionsElevator(e){let t=n()(e.target),i=Math.ceil(Number(t.val()));t.val("").blur(),i?(i<1?this.pagerItemActiveIndex=1:i>this.pageNumber?this.pagerItemActiveIndex=this.pageNumber:this.pagerItemActiveIndex=i,this.$bus.$emit("modifySinglePagerIndex",this.pagerItemActiveIndex)):this.$bus.$emit("addWarningTip","输入的格式必须为数字！！！","warning")}},beforeUpdate(){},beforeDestroy(){n()(".pager-next").off("click"),n()(".pager-prev").off("click"),n()(".pager-item").off("click")}},N=A,P=(0,f.Z)(N,D,k,!1,null,"395ccad9",null),E=P.exports,y={name:"UserCollection",data(){return{formData:null,timer:new g.Timer,userDetailVisible:!1,invalidInfoSubstitutes:{judgeConditions:{dateFields:["log_off_date","update_username_date","login_time","register_time"],logoffField:"log_off",logoff:"1"},substitutes:{nullValueSubstitute:"暂无信息",logoff:"是",noLogoff:"否"}},users:{userInfoAttribute:["UID","用户ID","用户名","最近用过的用户名","更新用户名日期","最近登陆日期","注册日期","是否注销","注销时间"],userInfoDatabaseField:[],userInfo:[],singlePageUserInfo:[],editingUserInfo:null},pagerConfig:{pagerTotal:void 0,pageLimit:10,pagerCurrentIndex:1}}},components:{UserDetails:I,EditTools:w,pager:E},computed:{clickedUserIndex(){return Number(this.$route.query["clickedUserIndex"])}},created(){this.initUsersInfos()},mounted(){this.$bus.$on("modifySinglePagerIndex",this.modifySinglePagerIndex)},methods:{modifySinglePagerIndex(e){e&&e>=1&&e<=this.pagerConfig.pagerTotal&&(this.pagerConfig.pagerCurrentIndex=e,this.divideUserInfosToPage())},shutdownUserDetails(){this.userDetailVisible=!1},getOneUserInfo(e){let t=(this.pagerConfig.pagerCurrentIndex-1)*this.pagerConfig.pageLimit+e-1;this.users.editingUserInfo=this.users.userInfo[t],this.userDetailVisible=!0},deleteUser(e){if(confirm(o().unrecoverable)&&confirm(o().unrecoverable)&&confirm(o().unrecoverable)){let t=(this.pagerConfig.pagerCurrentIndex-1)*this.pagerConfig.pageLimit+e-1,i=this.users.userInfo[t];this.formData=new FormData,this.formData.append("uid",i["uid"]),this.formData.append("user_id",i["user_id"]),this.formData.append("deleteUser",""),this.sendRequest(d().SERVLETS.OPERATE_USER_SERVLET,(i=>{let s,a,r=i.data;"deleteUserSucceed"===r?(this.users.singlePageUserInfo.splice(e-1,1),this.users.userInfo.splice(t,1),s="删除用户成功！",a="finished"):(s="删除用户失败！",a="fail"),this.$bus.$emit("addWarningTip",s,a)}))}},commitUserDetails(e){this.shutdownUserDetails();let t,i,s=0,a=this.users.userInfoDatabaseField,r=!1;this.formData=new FormData;for(let n in this.users.editingUserInfo)t=this.users.editingUserInfo[n],i=e[s],i=i||null,t!==i?(r=!0,this.formData.append(a[s],i)):["user_id","uid"].includes(a[s])&&this.formData.append(a[s],t),s++;r?(this.formData.append("updateUserInfos",""),this.sendRequest(d().SERVLETS.OPERATE_USER_SERVLET,(e=>{let t,r,n=e.data;switch(n){case"updateUserInfoSucceed":this.users.editingUserInfo[a[s]]=i,t="用户信息修改成功！",r="finished";break;case"hasSameUsername":t="已存在相同用户名！",r="fail";break;case"databaseException":t="数据库抛出未知异常！！！",r="fail";break;default:t="用户信息修改失败！",r="fail"}this.$bus.$emit("addWarningTip",t,r)}))):this.$bus.$emit("addWarningTip","请修改除 UID 和 用户名 之外的至少一项！！！","warning")},divideUserInfosToPage(){let e=(this.pagerConfig.pagerCurrentIndex-1)*this.pagerConfig.pageLimit,t=this.pagerConfig.pagerCurrentIndex*this.pagerConfig.pageLimit;this.users.singlePageUserInfo=this.users.userInfo.slice(e,t)},initUsersInfos(){this.formData=new FormData,this.formData.append("getUserAllInfo",""),this.sendRequest(d().SERVLETS.OPERATE_USER_SERVLET,(e=>{let t=e.data;if("object"===typeof t){this.users.userInfo=t,this.pagerConfig.pagerTotal=t.length,this.divideUserInfosToPage();for(let e in t[0])this.users.userInfoDatabaseField.push(e)}else this.$bus.$emit("addWarningTip","用户信息获取失败","fail")}))},scrollAutoShow(){n()(".user-collection-form").css("overflow-x","auto"),this.timer.timeout((function(){n()(".user-collection-form").css("overflow-x","hidden")}),1500)},formatDate(e){return e&&""!==e?(e=e.split(/[\s-:.]/),e[0]+"年"+e[1]+"月"+e[2]+"日 "+e[3]+":"+e[4]+":"+e[5]):this.invalidInfoSubstitutes.substitutes.nullValueSubstitute},sendRequest(e,t){this.$bus.$emit("sendRequest",e,t,this.formData)}},watch:{"users.userinfo.length":{immediate:!0,handler(e,t){e!==t&&(this.users.pagerTotal=this.users.userInfo.length)}}},beforeDestroy(){n()(".user-collection-origin tr").off(),this.$bus.$off("clickCommitModify")}},S=y,T=(0,f.Z)(S,s,a,!1,null,"9ef303f2",null),$=T.exports}}]);
//# sourceMappingURL=480.27b6b9ed.js.map