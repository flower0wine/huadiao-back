$(function () {

    var allObject = {
        follow: $('.follow'),
        homepageBelow: $('.homepage-below'),
        userInformation: $('.userInformation'),
        userActiveFollow: $('.userActive-follow'),
        userActivefans: $('.userActive-fans'),
        userActiveStar: $('.userActive-star'),
        homepageBackground: $('.homepageBackground'),
    }

    var user;

    // 请求头
    const HEADERS_OPTIONS = {
        // 基本参数传输
        HEADERS_PARAMS: {
            "Content-Type": "application/x-www-form-urlencoded; charset=utf-8"
        },
        // 文件传输
        HEADERS_FILE: {
            // "Content-Type": "multipart/form-data"
        }
    }


    var browserServer = {

        uid: null,

        // 主机地址
        localhost: window.localhost,

        // 图片路径，安全性不高，有能力会进行更改
        localhost_homepage_background: window.localhost_homepage_background,

        localhost_user_avatar: window.localhost_user_avatar,

        // 获取用户信息
        getUserInfer: function () {
            let uid = browserServer.getUrlUid();
            let params = {
                "requestType": "homepage",
                "operation": "getHomepageInfer",
                uid
            };
            browserServer.browserServerCore(params, HEADERS_OPTIONS.HEADERS_PARAMS, null, function (response) {
                user = response.data;
                console.log(user)
                // JSON 将 isMe 前面的 is 去掉了
                browserServer.loadUserInfer();
                otherEvent.isMe();
                otherEvent.followInitial();
                otherEvent.followClick();
            });

        },

        // 加载获取到的用户信息
        loadUserInfer: function () {
            // 有背景设置背景，没有使用默认背景
            if (typeof user.pageBackground != 'undefined') {
                allObject.homepageBackground.css('background-image', 'url(' + browserServer.localhost_homepage_background + user.pageBackground + ')');
            }
            var information = allObject.userInformation;
            if (user.nickname == '') {
                information.children('.nickname').text(user.userId);
            } else {
                information.children('.nickname').text(user.nickname);
            }
            information.find('.born').text(user.bornDate);
            information.find('.school').text(user.school);
            if (typeof user.canvases != 'undefined') {
                var content = user.canvases.substring(0, 25) + '<br>';
                if (user.canvases.length > 25) {
                    var length = (user.canvases.length) / 27;
                    for (var i = 0; i < length; i++) {
                        content += user.canvases.substring(27 * (i + 1), 27 * (i + 2)) + '<br>';
                    }
                }
                information.find('.canvases').html(content);
            }
            if (user.school !== '') {
                $('.bornAndSchool a').prop('href', 'https://www.baidu.com/s?tn=68018901_39_oem_dg&ie=utf-8&word=' + user.school).prop('title', user.school);
            }

            allObject.userActiveFollow.parents('a').prop('href', browserServer.localhost + user.uid + '/follow/follow');
            allObject.userActiveFollow.children('.followNumber').text(user.followNumber);
            allObject.userActivefans.parents('a').prop('href', browserServer.localhost + user.uid + '/follow/fans');
            if (user.fansNumber < 9999) {
                allObject.userActivefans.children('.fansNumber').text(user.fansNumber);
            } else {
                allObject.userActivefans.children('.fansNumber').text((user.fansNumber / 10000).toFixed(0) + '万');
            }
            $('.starNumber').text(user.starNumber);
            $('.likeNumber').text(user.likeNumber);
            $('.likeFanju').parent('a').prop('href', browserServer.localhost + 'panoperaHouse/' + user.uid).children('.likeFanju-number').text(user.fanjusNumber);
            $('.notes').parents('a').prop('href', browserServer.localhost + user.uid + '/notes').children('.notes-number').text(user.notesNumber);
        },


        // 获取 url 中的 uid
        getUrlUid: function () {
            if (!browserServer.uid) {
                let url = window.location.href;
                browserServer.uid = url.split('/')[5];
            }
            return browserServer.uid;
        },


        // 将关注及取消关注的改变发送给服务端
        sendFollowStatus: function (followStatus) {
            let params = {
                requestType: "followsFans",
                operation: "changeFollowStatus",
                uid: browserServer.getUrlUid(),
                followStatus
            }
            browserServer.browserServerCore(params, HEADERS_OPTIONS.HEADERS_PARAMS, null, function (response) {
                console.log(response.data);
            });
        },


        // 更改页面背景
        changeBackground: function () {
            let input = $('#homepageBackground');
            input.on('change', function () {
                let imgUrl = browserServer.getImgPath(input);
                allObject.homepageBackground.css('background-image', 'url(' + imgUrl + ')');

                // 上传文件
                let formData = new FormData();
                formData.append("homepageBackground", input[0].files[0]);
                let params = {
                    requestType: "homepage",
                    operation: "homepageBackground"
                };
                browserServer.browserServerCore(params, HEADERS_OPTIONS.HEADERS_FILE, formData, function (response) {
                    console.log(response.data);
                });
                input.val('');
            })
        },

        // 上传头像
        uploadAvatar: function () {
            $('#changeAvater').on('change', function () {
                let imgUrl = browserServer.getImgPath($(this));
                if ($('.changeTitle .img-avatar').length === 0) {
                    let myAvatar = $('<div class="changeTitle" title="更换头像"><label for="changeAvater"><div class="avatar-box"><div class="img-avatar"></div></div></label><input type="file" name="changeAvater" id="changeAvater"></div>');
                    myAvatar.find('.img-avatar').css('background-image', 'url(' + imgUrl + ')');
                    $('.homepageavater').empty().append(myAvatar);
                } else {
                    $('.img-avatar').css('background-image', 'url(' + imgUrl + ')');
                }
                let formData = new FormData();
                formData.append("userAvatar", this.files[0]);
                let params = {
                    requestType: "homepage",
                    operation: "userAvatar"
                };
                browserServer.browserServerCore(params, HEADERS_OPTIONS.HEADERS_FILE, formData, function (response) {
                    console.log(response.data);
                });
                $(this).val('');
            })

        },


        // 将带文件的 input 传入，返回的 url 可以放在 img 标签的 src 或者 任何盒子的 background-image 中
        getImgPath: function (obj) {
            let o = obj[0];
            let fileObj = o.files[0];
            let url;
            if (window.createObjectURL != undefined) {
                url = window.createObjectURL(fileObj);
            } else if (window.URL != undefined) {
                url = window.URL.createObjectURL(fileObj);
            } else if (window.webkitURL != undefined) {
                url = window.webkitURL.createObjectURL(fileObj);
            }
            return url;
        },

        browserServerCore: function (params, headers, data = {}, fn) {
            axios({
                url: browserServer.localhost + 'dispatcherServlet',
                method: 'post',
                params,
                headers,
                data
            }).then(fn);
        }

    }

    browserServer.getUserInfer();

    var otherEvent = {

        getSessionId: window.getUniqueString,

        // 判断是否是本人进入
        isMe: function () {
            if (user.me) {
                // 本人预览时的头像
                if (typeof user.userAvatar == 'undefined') {
                    let myAvatar = $(' <div class="changeTitle" title="更换头像"><label for="changeAvater"><svg t="1658193093936" class="icon avater" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3788"><path d="M510.77050482 2.21923328c281.4240859 0 509.56537287 228.14128697 509.56537173 509.56653682 0 281.42757888-228.14128697 509.56653682-509.56537173 509.56653681-281.42757888 0-509.56886585-228.14012302-509.56886585-509.56653681 0-281.4240859 228.14128697-509.56653682 509.56886585-509.56653682z" fill="#EEEEEE" p-id="3789"></path><path d="M510.77050482 516.51164387c90.0558939 0 163.05952199-73.30168832 163.05952199-163.72549973 0-90.42264633-73.00362809-163.72433465-163.05952199-163.72433465-90.05705785 0-163.06301497 73.30168832-163.06301497 163.72433465-0.00116395 90.42497536 73.00479317 163.72549859 163.06301497 163.72549973z m251.51800206 200.09807531l1.21552441-0.45756757c-39.85964146-100.90130205-137.98992099-172.25861689-252.73352647-172.25861689-113.31967317 0-210.42537358 69.60155875-251.2141221 168.51890176l0.56235463 0.22820181a39.9609344 39.9609344 0 0 0-2.9188881 15.01940622c0 22.15886393 17.97555086 40.12510094 40.15420757 40.12509981 16.79146325 0 31.16701469-10.30401138 37.16196921-24.92522837l0.65433486 0.26545948c28.69987328-68.84360192 96.50958109-117.22355485 175.60014393-117.22355484 79.76934741 0 148.05874461 49.21940878 176.32433493 119.00725475l0.2875813-0.10828003c6.4338944 13.58499499 20.27037696 22.98434901 36.30970538 22.98434901 22.17516373 0 40.15187968-17.96507307 40.15187968-40.12509981a40.14256469 40.14256469 0 0 0-1.55549923-11.05032533z" fill="#CCCCCC" p-id="3790"></path></svg></label><input type="file" name="changeAvater" id="changeAvater"></div>');
                    $('.homepageavater').append(myAvatar);
                } else {
                    let myAvatar = $('<div class="changeTitle" title="更换头像"><label for="changeAvater"><div class="avatar-box"><div class="img-avatar"></div></div></label><input type="file" name="changeAvater" id="changeAvater"></div>');
                    myAvatar.find('.img-avatar').css('background-image', 'url(' + browserServer.localhost_user_avatar + user.userAvatar + ')');
                    $('.homepageavater').append(myAvatar);
                }

                // 右上角更换背景及账号设置
                let rightEntry = $('<ul class="right-entry"><li class="changeBackground"><label for="homepageBackground" class="iconfont localImage" title="上传背景"><svg t="1658208499429" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4931"><path d="M1029.81530905 562.87535408V822.68918518c0 78.6432-63.75600947 142.39920947-142.39921069 142.39920948H136.58390164c-78.6432 0-142.39920947-63.75600947-142.39921069-142.39920948V201.31081482c0-78.6432 63.75600947-142.39920947 142.39921069-142.39920948h750.83219672c78.6432 0 142.39920947 63.75600947 142.39921069 142.39920948v361.56453926z m-77.6722963-90.56589749V201.31081482a64.72691317 64.72691317 0 0 0-64.72691439-64.72691318H136.58390164a64.72691317 64.72691317 0 0 0-64.72691439 64.72691318v418.07113481A352.06262875 352.06262875 0 0 1 123.63851852 615.56306132a348.16606815 348.16606815 0 0 1 222.45345659 79.91184832C408.87708089 531.88410785 566.50006164 421.38232059 745.01688889 421.38232059c79.74355794 0 154.12772622 20.36308741 207.12612386 50.927136z m0 99.80890074c-6.47269095-10.09739852-25.64480356-26.27912651-52.97250607-39.94945065C857.60288237 511.37862163 804.53975822 499.05461689 745.01688889 499.05461689c-147.78448949 0-278.07976653 92.55948683-328.204288 229.00382105-3.31401838 9.03587673-8.98409601 24.66095408-16.98434253 46.82344888-9.32067555 25.85192889-41.81358577 34.11108386-62.34496235 15.84514843-19.94883436-17.76106549-34.65478994-30.42164978-43.85895704-37.80051793A270.50671764 270.50671764 0 0 0 123.63851852 693.23535762c-17.55393897 0-34.86191525 1.65700859-51.78153127 4.91924624V822.68918518a64.72691317 64.72691317 0 0 0 64.72691439 64.72691318h750.83219672a64.72691317 64.72691317 0 0 0 64.72691439-64.72691318V572.10541155zM278.98311111 473.16385185a116.50844445 116.50844445 0 1 1 0-233.01688888 116.50844445 116.50844445 0 0 1 0 233.01688888z m0-77.6722963a38.83614815 38.83614815 0 1 0 0-77.6722963 38.83614815 38.83614815 0 0 0 0 77.6722963z" p-id="4932"></path></svg></label><input type="file" name="homepageBackground" id="homepageBackground"></li><li class="userSettings"><a href="javascript:;" target="_blank" title="账号设置"><svg t="1658208541351" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5075"><path d="M550.43920099 1024.61349661l-75.02950172 0c-33.38383246 0-62.15007005-28.76507363-62.15007004-62.14075506L413.25962923 917.57519531c0-10.94903011-8.90452878-23.79236921-18.9896522-26.94295211l-1.78253596-0.69624832-63.40285099-26.2874533-1.00129337-0.56235463c-9.27710322-5.018112-25.05097216-2.70349312-32.48616106 4.7642954l-32.05653618 31.99832064c-11.29831879 11.35187627-26.44114091 17.62975517-42.58991332 17.62975516-16.15110144 0-31.29741539-6.2778789-42.65278464-17.68331378l-53.11397546-53.05459712c-23.44308053-23.44191659-23.47451733-61.7053093-0.07917227-85.30440533l32.02859235-31.97852786c7.55161771-7.48059534 9.87205746-23.43725966 4.83997469-32.89249905l-0.94657195-2.01190173-26.35614663-63.86158365-0.30621013-0.77658453c-3.19016846-10.27956053-16.24657351-19.79068757-26.86494379-19.79068757l-45.09198336 0c-33.44088291 0-60.14515427-27.3807269-60.14515427-60.52238564l0-75.02950172c0-32.73415566 26.16753152-58.88538624 60.21035462-58.88538624l45.02794696 0c10.33311915 0 23.6701184-10.04670179 26.92665116-20.5451503l0.64618382-1.68007793 26.35498269-64.95369216 0.57516145-1.03971499c5.01112605-9.35278251 2.63945671-25.28615993-4.88072533-32.802849l-31.9051776-31.95757112c-11.33790549-11.28900494-17.62044131-26.41552611-17.6379062-42.54916267-0.01746489-16.15808626 6.24877113-31.33118009 17.64372707-42.72613603l53.08370489-53.03713224c11.31112675-11.36119125 26.45161984-17.63907015 42.58991332-17.63907015 0.00116395 0 0 0 0.00116395 0 16.13829347 0 31.27762261 6.27904285 42.6318279 17.68214869l31.90284858 31.91565654c7.46080256 7.42470997 23.32548665 9.78124231 32.60375381 4.81435989l1.01642923-0.54488974 65.28085902-26.90802347c10.05368775-3.10750322 18.92678087-15.97179904 18.92678087-26.98719459l0-45.09314731c0-32.9588645 28.19107613-59.27309653 62.15007004-59.27309653L550.43920099 2.36244082c33.17891641 0 59.58629262 25.75537038 59.58629263 59.27309653l0 45.09314731c0 10.38551154 9.90931513 23.7283328 20.21565553 26.93596615l1.72548552 0.65666276 64.44373106 26.29793222 1.05019392 0.57981839c9.33298859 5.03441181 25.24075235 2.67787833 32.75511238-4.84113863l32.04372822-31.75847595c11.25873323-11.31112675 26.37361152-17.45278293 42.49909817-17.45278293 0.02212181 0 0.04657152 0 0.06869333 0 16.1429504 0 31.29857934 6.11604139 42.68538539 17.50401138l53.14541227 52.96843889c11.38331307 11.33324857 17.66351986 26.45860466 17.66351985 42.63881387 0 16.1429504-6.25575709 31.29625145-17.61229141 42.70401422l-32.04955022 32.03092139c-7.4875813 7.52134599-9.83130795 23.63286073-4.78408818 33.11837297l0.54488974 1.01992221 26.91384434 65.9421787c3.30194034 10.53104925 16.65174755 20.61035065 26.94993806 20.61035065l44.52380672 0 0-0.65200469c31.43596601 0 59.37904754 26.15123171 59.37904754 59.53739207l0 75.0912091c0 33.66791965-26.15239566 60.45951317-58.87607239 60.45951318l-45.09081828 0c-10.62419229 0-23.72134685 9.52626176-26.94993806 19.82445226l-0.66015573 1.72548551-26.26766052 63.98965647-0.53324686 0.97917269c-5.02858979 9.44825458-2.7232859 25.39560391 4.74450261 32.83079168l32.01229255 31.88072675c11.41358478 11.41125575 17.68098475 26.56804864 17.67865572 42.71332808-0.00465693 16.14062251-6.27438592 31.29508637-17.6565339 42.67257742l-53.18849081 53.11397546c-11.28784099 11.33790549-26.41901909 17.64256313-42.56080555 17.64256313-0.02212181 0-0.04657152 0-0.06869333 0-16.14760846 0-31.3055653-6.27438592-42.68771328-17.65536995l-31.90284857-31.96688498c-7.38512327-7.38512327-23.67477533-9.75679261-32.86804935-4.78641721l-1.08279467 0.58564039-65.92005689 26.94295211c-10.34010397 3.25304093-20.27969081 16.60517603-20.27969081 26.95575893l0 44.89754624C610.02549362 996.42474951 583.06507662 1024.61349661 550.43920099 1024.61349661zM409.44889173 847.52189099c28.66377955 9.52393387 50.38370361 39.42419456 50.38370361 70.05330432l0 44.89754624c0 8.09417955 7.47477447 15.56895289 15.57826788 15.56895288L550.43920099 978.04169443c7.39210923 0 14.17878528-6.87632611 14.17878528-15.56895288L564.61798627 917.57519531c0-29.89327587 22.20543545-60.45136327 51.08810298-70.0649472l61.28034133-25.10220174c26.88357262-13.78641806 64.10492131-8.07671467 85.46857073 13.28344177l31.86908388 32.03208533c2.76752953 2.7652005 6.46067314 4.36610617 10.44372708 4.36610618 0.00698595 0 0.01280683 0 0.01746488 0 3.96209607 0 7.65291179-1.59159182 10.39366144-4.34631339l53.22574848-53.17801188c2.77218645-2.77218645 4.30439879-6.51306667 4.30672783-10.49495552 0-3.97723193-1.52988331-7.70763321-4.30905572-10.48680561l-31.97852785-31.85627706c-21.26934243-21.17387037-27.03609515-58.42432569-13.3952148-85.37542769l25.12665145-60.9892682c9.52859079-28.63467293 40.07736434-50.6468352 70.06261931-50.6468352l45.09081828 0c8.81254969 0 12.30427022-8.06274275 12.30427022-15.05200697l0-75.0912091c0-7.80776221-5.82147527-13.73751751-12.80724537-13.99715498l0 1.68357091-44.52380672 0c-29.85136128 0-60.41527069-22.92613347-70.07076921-52.03700281l-25.12665145-61.7379089c-13.60828075-26.91384434-7.86597774-64.28771555 13.34398521-85.59315058l32.04955022-32.07632896c2.7652005-2.77800846 4.3102208-6.55847424 4.3102208-10.57645682 0-3.98072491-1.51824043-7.6936613-4.27762005-10.43790507l-53.18150485-52.99521763c-2.80129422-2.80129422-6.52703858-4.24851229-10.5065984-4.24851229-0.00465693 0-0.01164288 0-0.01513586 0-3.94346723 0-7.62380402 1.42859037-10.35989789 4.17749106l-32.08331491 31.90052067c-21.28098531 21.28797127-58.50116893 27.00465949-85.3335131 13.30090667l-61.2873273-25.11384462c-28.90362425-9.54372665-51.1253595-40.11345693-51.1253595-70.09289102l0-45.09314731c0-8.25252295-6.2778789-13.86559033-14.17878528-13.86559033l-75.02950172 0c-8.55291107 0-15.57826787 6.27904285-15.57826788 13.86559033l0 45.09314731c0 30.75136057-21.73971683 60.68538709-50.43260416 70.13713351l-60.87283826 25.0276864c-27.11876039 13.84463246-63.55304562 8.23156622-85.19496134-13.30789262l-32.00647055-31.9890068c-2.77800846-2.78965134-6.47464505-4.30905571-10.41345536-4.30905571-3.93997426-0.00116395-7.62846094 1.51824043-10.37386865 4.27645611l-53.12329046 53.07322595c-2.77451549 2.77451549-4.30556274 6.49676686-4.30206976 10.47632669 0.00465693 3.95278222 1.52406243 7.64243285 4.28111303 10.38667662l31.93544932 31.99599274c21.27516331 21.26584946 27.05938091 58.46973326 13.43596544 85.30324139l-25.17322297 62.36546503c-9.57283442 29.14579797-40.14256469 52.09172537-70.09056199 52.09172537l-45.02794695 0c-7.54346781 0-14.80284729 3.88175986-14.80284729 12.31358407l0 75.02950173c0 7.89857735 6.54566627 15.11487829 14.73764693 15.11487829l45.09198336 0c30.01552669 0 60.52471353 22.0168192 70.00091193 50.67361394l25.23842333 61.01837482c13.68512398 27.00116651 7.87179861 64.22717213-13.49767282 85.39754952l-31.88305579 31.80039054c-5.71319637 5.76442482-5.74463203 15.18706461 0.01164288 20.94566855l53.15006919 53.08137586c2.79081529 2.80362211 6.48046592 4.31720562 10.4320842 4.31720561 3.95045319 0 7.63661085-1.52056946 10.38201856-4.27762005l32.06468608-31.99715669c21.20996295-21.31125703 58.52794766-27.02561621 85.34631992-13.24618524L409.44889173 847.52189099z" p-id="5076"></path><path d="M513.97348011 762.17557106c-137.26107193 0-248.93093888-111.66986695-248.93093888-248.93093888s111.66986695-248.93093888 248.93093888-248.93093888 248.93093888 111.66986695 248.93093888 248.93093888S651.23571712 762.17557106 513.97348011 762.17557106zM513.97348011 309.84461426c-112.15421326 0-203.40001678 91.24463843-203.40001678 203.40001678s91.24463843 203.40001678 203.40001678 203.40001678 203.40001678-91.24463843 203.40001678-203.40001678S626.12885845 309.84461426 513.97348011 309.84461426z" p-id="5077"></path></svg></a></li></ul>');
                rightEntry.find('.userSettings').children('a').prop('href', browserServer.localhost + 'settings')
                $('.huadiao-homepage-header').append(rightEntry);

                // 更改资料入口
                let changeInformation = $('<div class="changeInformation"><a href="javascript:;" target="_blank" title="修改资料"><div class="changeInformationWord">修改资料</div><div class="changeInformationForword"><svg t="1658200008985" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4787"><path d="M756.94275079 1031.34343916l88.81568175-79.38914172a1.3256072 1.3256072 0 0 0 0-1.91476595L357.19853812 513.62018657a1.3256072 1.3256072 0 0 1 0-1.91476594l488.55989442-436.56663462a1.3256072 1.3256072 0 0 0 0-1.91476594l-88.81568175-79.38914172a1.3256072 1.3256072 0 0 0-1.76747625 0L173.97016652 509.79065468a1.3256072 1.3256072 0 0 0 0 1.91476595 1.3256072 1.3256072 0 0 1 0 1.91476594 1.3256072 1.3256072 0 0 0 0 1.91476593l581.20510802 515.80848666a1.3256072 1.3256072 0 0 0 1.76747625 0z" p-id="4788"></path></svg></div></a></div>');
                changeInformation.find('a').prop('href', browserServer.localhost + 'settings/information').prop('title', '修改资料');
                $('.userActive-header').append(changeInformation);

                otherEvent.changeSex('我');
                otherEvent.setSexIcon();

                browserServer.changeBackground();
                browserServer.uploadAvatar();

            } else {
                // 其他人的头像
                if (typeof user.userAvatar == 'undefined') {
                    let otherAvatar = $('<svg t="1658193093936" class="icon avater" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3788"><path d="M510.77050482 2.21923328c281.4240859 0 509.56537287 228.14128697 509.56537173 509.56653682 0 281.42757888-228.14128697 509.56653682-509.56537173 509.56653681-281.42757888 0-509.56886585-228.14012302-509.56886585-509.56653681 0-281.4240859 228.14128697-509.56653682 509.56886585-509.56653682z" fill="#EEEEEE" p-id="3789"></path><path d="M510.77050482 516.51164387c90.0558939 0 163.05952199-73.30168832 163.05952199-163.72549973 0-90.42264633-73.00362809-163.72433465-163.05952199-163.72433465-90.05705785 0-163.06301497 73.30168832-163.06301497 163.72433465-0.00116395 90.42497536 73.00479317 163.72549859 163.06301497 163.72549973z m251.51800206 200.09807531l1.21552441-0.45756757c-39.85964146-100.90130205-137.98992099-172.25861689-252.73352647-172.25861689-113.31967317 0-210.42537358 69.60155875-251.2141221 168.51890176l0.56235463 0.22820181a39.9609344 39.9609344 0 0 0-2.9188881 15.01940622c0 22.15886393 17.97555086 40.12510094 40.15420757 40.12509981 16.79146325 0 31.16701469-10.30401138 37.16196921-24.92522837l0.65433486 0.26545948c28.69987328-68.84360192 96.50958109-117.22355485 175.60014393-117.22355484 79.76934741 0 148.05874461 49.21940878 176.32433493 119.00725475l0.2875813-0.10828003c6.4338944 13.58499499 20.27037696 22.98434901 36.30970538 22.98434901 22.17516373 0 40.15187968-17.96507307 40.15187968-40.12509981a40.14256469 40.14256469 0 0 0-1.55549923-11.05032533z" fill="#CCCCCC" p-id="3790"></path></svg>');
                    $('.homepageavater').append(otherAvatar);
                } else {
                    let otherAvatar = $('<div class="avatar-box"><div class="img-avatar"></div></div>');
                    otherAvatar.find('.img-avatar').css('background-image', 'url(' + browserServer.localhost_user_avatar + user.userAvatar + ')');
                    $('.homepageavater').append(otherAvatar);
                }

                // 私信入口
                let privateMessage = $('<div class="privateMessage"><a href="javascript:;" target="_blank" title="与他聊聊"><div class="privateIcon"><svg t="1658195533705" class="icon" viewBox="0 0 1879 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4073"><path d="M774.95017339 1302.32498967C356.84915952 1302.32498967 17.85503938 948.45182942 17.85503938 512S356.84915952-278.07700548 774.95017339-278.07700548h302.54047321c418.10101386 0 756.84715148 353.87316027 756.84715149 790.32498967 0 13.39113493-1.23991931 26.28630319-1.98387191 39.42945562h1.73588771v750.64754986H1083.93823074v-0.24798419c-2.23185611 0-4.21572801 0.24798419-6.44758414 0.24798419H774.95017339z m-7.19153502-1462.11363003c-349.16146386 0-632.35918474 300.80458551-632.35918646 671.78864036s283.1977209 671.78864036 632.35918646 671.78864036h949.0347455v-632.35918478h-2.47984032c0.7439526-13.14315243 1.73588771-26.28630319 1.73588941-39.42945558 0-370.98405483-283.1977209-671.78864036-632.35918642-671.78864036H767.75863837z m-114.81658974 750.89553408c-45.38107132 0-82.08270243-35.46171178-82.08270241-79.10689372 0-43.64518363 36.7016311-79.10689372 82.08270241-79.10689372s82.08270243 35.46171178 82.08270244 79.10689372c0 43.64518363-36.9496153 79.10689372-82.08270244 79.10689372z m273.52634557 0c-45.38107132 0-82.08270243-35.46171178-82.08270242-79.10689372 0-43.64518363 36.7016311-79.10689372 82.08270242-79.10689372s82.08270243 35.46171178 82.08270242 79.10689372c0 43.64518363-36.7016311 79.10689372-82.08270242 79.10689372z m273.77432972 0c-45.38107132 0-82.08270243-35.46171178-82.08270241-79.10689372 0-43.64518363 36.7016311-79.10689372 82.08270241-79.10689372s82.08270243 35.46171178 82.08270244 79.10689372c0 43.64518363-36.9496153 79.10689372-82.08270244 79.10689372z" p-id="4074"></path></svg></div><div class="privateWord">私信</div></a></div>');
                // 关注及取消关注
                let follow = $('<div class="follow"><div class="followIcon"><svg t="1658195667304" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4215"><path d="M512 26.54814777c147.456 0 266.9985189 119.5425189 266.9985189 266.9985189 0 95.86460445-50.51126557 179.92059221-126.37525333 227.00942222a483.87413333 483.87413333 0 0 1 173.91312554 94.9665189 36.40888889 36.40888889 0 1 1-47.21019221 55.45073778A410.78935666 410.78935666 0 0 0 512 572.6814811c-214.66680889 0-393.02181888 164.60458667-411.12917333 377.07472669a36.40888889 36.40888889 0 0 1-72.55077888-6.17737558c17.19713223-201.75379001 157.06794667-366.75887445 343.09309554-423.01060664C295.54915555 473.50366777 245.0014811 389.42340779 245.0014811 293.54666667c0-147.456 119.5425189-266.9985189 266.9985189-266.9985189z m473.25487445 713.82054002l1.21362888 1.15294776a33.93308445 33.93308445 0 0 1 0 49.39472555l-184.61733888 174.03448889a36.32393443 36.32393443 0 0 1-25.89885668 9.90321778 36.32393443 36.32393443 0 0 1-25.91099222-9.90321778l-106.02268444-99.9424a33.93308445 33.93308445 0 0 1 0-49.39472554l1.22576555-1.15294778a36.40888889 36.40888889 0 0 1 49.95299555 0l80.75491556 76.11885 159.34957113-150.21093888a36.40888889 36.40888889 0 0 1 49.95299555 0zM512 99.36592555c-107.24844999 0-194.18074112 86.93228999-194.18074112 194.18074112s86.93228999 194.18074112 194.18074112 194.18074112 194.18074112-86.93228999 194.18074112-194.18074112-86.93228999-194.18074112-194.18074112-194.18074112z" p-id="4216"></path></svg></div><div class="followWord"></div></div>');
                allObject.homepageBelow.append(follow).append(privateMessage);

                allObject.follow = $('.follow');

                // 不是再判断性别
                if (user.sex === '0') {
                    let li = $('.userActive-body ul li:eq(0)');
                    li.children('a').children('.likeFanju').text('喜欢的番剧');

                    li = $('.userActive-body ul li:eq(1)');
                    li.children('a').children('.notes').text('笔记');

                } else if (user.sex === '1') {
                    otherEvent.changeSex('他');
                } else if (user.sex === '2') {
                    otherEvent.changeSex('她');
                }

                otherEvent.setSexIcon();
            }
        },

        // 设置性别图标
        setSexIcon: function () {
            var sexAvater;
            if (user.sex === '0') {
                sexAvater = $('<svg t="1658213806324" class="icon noknownIcon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6106"><path d="M936.70987 800.414756q5.104686 15.314058 7.657029 39.306082t2.552343 48.494516-3.57328 45.942173-10.71984 32.66999q-5.104686 7.14656-28.075773 14.293121t-56.662014 13.782652-75.549352 11.740778-83.716849 9.188435-81.164506 6.125623-68.91326 2.041874-68.402792-2.552343-80.143569-6.125623-81.674975-8.167498-74.017946-9.698903-56.662014-10.209372-29.09671-10.209372q-10.209372-8.167498-15.824526-50.025922t3.57328-108.219342q6.125623-37.774676 30.628116-57.172483t57.172483-31.138584 67.892323-20.929212 62.787637-26.544367q21.439681-13.272183 32.66999-25.52343t16.334995-24.502493 5.104686-25.52343-1.020937-29.607178q-2.041874-23.481555-16.334995-37.264207t-30.628116-28.075773q-8.167498-7.14656-14.803589-19.908275t-11.740778-26.033898q-5.104686-15.314058-10.209372-32.66999-9.188435-1.020937-18.376869-6.125623-8.167498-5.104686-16.334995-14.803589t-13.272183-27.054835-2.552343-31.649053 8.677966-24.502493q6.125623-11.230309 17.355932-21.439681 0-38.795613 4.083749-77.591226 4.083749-32.66999 14.293121-69.934197t31.649053-66.871386q19.397807-28.586241 42.879362-46.452642t48.494516-28.075773 49.515454-13.782652 47.984048-3.57328q29.607178 0 56.662014 6.636092t50.025922 17.866401 41.347956 25.52343 30.628116 28.586241q25.52343 32.66999 38.285145 72.48654t17.866401 74.528415q5.104686 40.837488 4.083749 81.674975 9.188435 5.104686 15.314058 13.272183 5.104686 7.14656 9.188435 18.376869t2.041874 27.565304q-2.041874 22.460618-10.209372 34.711864t-17.355932 19.397807q-11.230309 8.167498-23.481555 11.230309-5.104686 17.355932-10.209372 32.66999-5.104686 13.272183-11.740778 26.033898t-14.803589 19.908275q-18.376869 15.314058-30.628116 26.033898t-16.334995 36.24327q-3.062812 15.314058-2.552343 31.138584t8.167498 31.649053 23.481555 30.117647 44.410768 25.52343q24.502493 10.209372 54.62014 18.376869t58.19342 18.887338 50.025922 26.544367 31.138584 43.389831zM541.607178 577.850449q18.376869 0 31.649053-13.272183t13.272183-32.66999-13.272183-32.66999-31.649053-13.272183q-19.397807 0-32.66999 13.272183t-13.272183 32.66999 13.272183 32.66999 32.66999 13.272183zM579.381854 393.060818q-1.020937-12.251246 14.293121-26.033898t34.711864-30.117647 35.732802-37.264207 18.376869-47.473579q1.020937-28.586241-6.125623-54.109671t-24.502493-44.410768-44.410768-29.607178-63.808574-10.71984q-44.921236 0-75.549352 16.334995t-49.004985 38.795613-25.52343 47.473579-7.14656 41.347956q1.020937 19.397807 12.251246 28.075773t25.012961 9.188435 25.012961-7.657029 11.230309-22.460618q0-9.188435 5.615155-21.95015t15.314058-25.012961 23.481555-20.418744 30.117647-8.167498q33.690927 0 53.599202 16.845464t18.887338 42.368893q0 19.397807-15.824526 34.201396t-34.711864 30.117647-35.222333 32.66999-17.355932 40.837488l0 27.565304q1.020937 11.230309 11.230309 21.439681t27.565304 11.230309q17.355932-1.020937 27.054835-11.230309t9.698903-24.502493l0-17.355932z" p-id="6107"></path></svg>');
            } else if (user.sex === '1') {
                sexAvater = $('<svg t="1658194605337" class="icon manIcon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3931"><path d="M971.04672364 14.8973037h-319.58180095a7.62224133 7.62224133 0 0 0-7.56700728 7.62224135v70.97521874c0 4.19775653 3.42448481 7.62224133 7.56700728 7.62224134h203.42547092l-252.74910468 252.74910338a362.2221647 362.2221647 0 0 0-222.03920434-75.17297397 362.5535665 362.5535665 0 0 0-258.16200029 106.98754654A363.32683693 363.32683693 0 0 0 14.8973037 643.89791541c0 97.48736254 38.05597265 189.34089322 107.0427806 258.16200029A362.5535665 362.5535665 0 0 0 380.10208459 1009.1026963a362.5535665 362.5535665 0 0 0 258.21723433-107.0427806 362.5535665 362.5535665 0 0 0 106.98754654-258.16200029 362.16693063 362.16693063 0 0 0-75.06250715-221.81826937L922.93822894 169.55147632v202.98360099c0 4.19775653 3.42448481 7.62224133 7.56700727 7.62224134h71.0304528A7.62224133 7.62224133 0 0 0 1009.1026963 372.47984323V53.00851042A38.11120672 38.11120672 0 0 0 971.04672364 14.8973037zM380.10208459 912.72000729a269.15349366 269.15349366 0 0 1-268.82209188-268.82209188A269.15349366 269.15349366 0 0 1 380.10208459 375.02059078a269.15349366 269.15349366 0 0 1 268.87732463 268.87732463 269.15349366 269.15349366 0 0 1-268.87732463 268.82209188z" p-id="3932" fill="#1992e7"></path></svg>');
            } else if (user.sex === '2') {
                sexAvater = $('<svg t="1658213070244" class="icon womenIcon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5220"><path d="M728.2688 573.18892999A306.85411555 306.85411555 0 0 0 817.83466667 355.65795555a306.27157333 306.27157333 0 0 0-89.56586667-217.57952A303.06759111 303.06759111 0 0 0 512 47.8814811a302.63068445 302.63068445 0 0 0-216.22025443 90.14840889A306.90266112 306.90266112 0 0 0 206.16533333 355.65795555a306.65993443 306.65993443 0 0 0 89.5173211 217.57952 301.95105223 301.95105223 0 0 0 175.44230002 87.4298789V776.05925888h-122.8193189a8.68958777 8.68958777 0 0 0-8.59249777 8.6895889v65.00200221c0 4.75742777 3.88361443 8.64104334 8.59249777 8.64104334h122.8193189v151.70370333c0 4.80597333 3.88361443 8.68958777 8.59249778 8.6895889h64.56509554c4.75742777 0 8.64104334-3.88361443 8.64104334-8.6895889v-151.70370333h122.77077334c4.75742777 0 8.64104334-3.88361443 8.64104334-8.64104334v-65.05054777a8.68958777 8.68958777 0 0 0-8.64104334-8.64104334h-122.77077334v-115.39190443a302.82486557 302.82486557 0 0 0 175.34520889-87.47842446zM512 581.00470556a221.94858667 221.94858667 0 0 1-158.40293888-66.02145223 224.57002667 224.57002667 0 0 1-65.536-159.37384334 224.76420779 224.76420779 0 0 1 65.536-159.37384221A221.31749888 221.31749888 0 0 1 512 130.21411555c59.9047589 0 116.02299221 23.44732445 158.40293888 66.02145223a224.5214811 224.5214811 0 0 1 65.58454557 159.37384221 224.76420779 224.76420779 0 0 1-65.536 159.42238891A221.94858667 221.94858667 0 0 1 512 581.05324999z" p-id="5221" fill="#bb21e2"></path></svg>');
            }
            allObject.userInformation.children('.sex').append(sexAvater);
        },

        // 根据性别设置 他，她，我，未知不设置
        changeSex: function (sex) {
            let li = $('.userActive-body ul li:eq(0)');
            li.children('a').prop('title', sex + '的番剧馆').children('.likeFanju').text(sex + '喜欢的番剧');

            li = $('.userActive-body ul li:eq(1)');
            li.children('a').prop('title', sex + '的笔记').children('.notes').text(sex + '的笔记');
        },


        // 点击关注和点击取消关注
        followClick: function () {
            // 动画结束后才能再次点击
            allObject.homepageBelow.on('click', '.follow', function () {
                let followCopy = allObject.follow;
                followCopy.off('mouseenter').off('mouseleave');

                if (user.followed) {
                    // 取消关注
                    followCopy.css('background-color', '#df7233').children('.followIcon').hide().siblings('.followWord').text('关注');
                    allObject.homepageBelow.off('mouseenter').on('mouseenter', '.follow', function () {
                        followCopy.css('background-color', '#c4642d');
                    });
                    allObject.homepageBelow.off('mouseleave').on('mouseleave', '.follow', function () {
                        followCopy.css('background-color', '#df7233');
                    });
                    followCopy.stop().animate({
                        width: '5rem'
                    }, 300, function () {
                        user.followed = false;
                    });

                    browserServer.sendFollowStatus("cancel");

                } else {
                    // 关注他
                    followCopy.css('background-color', '#b9b9b9').children('.followIcon').css('display', 'inline-block').siblings('.followWord');
                    if (user.fans) {
                        $('.followWord').text('已互粉');
                    } else {
                        $('.followWord').text('已关注');
                    }
                    allObject.homepageBelow.off('mouseenter').on('mouseenter', '.follow', function () {
                        followCopy.css('background-color', '#a1a1a1');
                    });
                    allObject.homepageBelow.off('mouseleave').on('mouseleave', '.follow', function () {
                        followCopy.css('background-color', '#b9b9b9');
                    });
                    followCopy.stop().animate({
                        width: '6.25rem'
                    }, 300, function () {
                        user.followed = true;
                    });

                    browserServer.sendFollowStatus("confirm");
                }
            });
        },


        // 初始化关注框，根据两个人的关系
        followInitial: function () {
            let followCopy = allObject.follow;

            if (!user.followed) {
                // 未关注
                followCopy.css('background-color', '#df7233').children('.followIcon').hide().siblings('.followWord').text('关注');
                followCopy.width('5rem');
                allObject.homepageBelow.off('mouseenter').on('mouseenter', '.follow', function () {
                    followCopy.css('background-color', '#c4642d');
                });
                allObject.homepageBelow.off('mouseleave').on('mouseleave', '.follow', function () {
                    followCopy.css('background-color', '#df7233');
                });
            } else {
                // 已关注
                followCopy.css('background-color', '#b9b9b9').children('.followIcon').css('display', 'inline-block').siblings('.followWord');
                if (user.fans) {
                    $('.followWord').text('已互粉');
                } else {
                    $('.followWord').text('已关注');
                }
                followCopy.width('6.25rem');
                allObject.homepageBelow.off('mouseenter').on('mouseenter', '.follow', function () {
                    followCopy.css('background-color', '#a1a1a1');
                });
                allObject.homepageBelow.off('mouseleave').on('mouseleave', '.follow', function () {
                    followCopy.css('background-color', '#b9b9b9');
                });


            }
        },


    };
})